#!/bin/sh
# ss: minimal screenshot script for sharex hosts
# requirements: xclip, maim, curl, jq

# URL to uplaod to
url="https://modeus.is-inside.me/upload"
# Authentication Key
# You should change this to a value that makes sense (this ssapikey script just echos my key)
authtoken="$(cat $HOME/apikey)"
# Key name of the field to use authkey
formkey="key"
# JSON key to image URl
image="url"

maim -o -s /tmp/screenshot.png
if [[ $? == 1 ]]; then exit 1; fi
notify-send -t 2000 "Screenshot taken, uploading..."

curl --request POST -H "$formkey: $authtoken" -F file=@/tmp/screenshot.png $url | jq -r ".$image" | xclip -selection clipboard
notify-send -t 6000 "Screeshot uploaded!"
